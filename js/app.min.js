$(function(){var c={token:"pk.eyJ1IjoidG1mcm56IiwiYSI6IkRNZURKUHcifQ._ljgPcF75Yig1Of8adL93A",base_id:"nzherald.9uvaq0k9",young_id:"nzherald.8vzhbyb9",all_id:"nzherald.nq5pcik9",map_url:"http://dumparkltd.github.io/NZresidentchange/",parent_url:"http://localhost:8888/NZresidentchange/embed.html",zoom_max:12,bounds_min:L.latLngBounds(L.latLng(-46.5,167.3),L.latLng(-35,178.5)),bounds_max:L.latLngBounds(L.latLng(-57.1,135),L.latLng(-23.7,210)),},b={x:"",y:"",z:""},e={young:"",all:""},a;g();d();j();$(".reset-map").on("click",function(m){m.preventDefault();h()});function h(){k();b={x:"",y:"",z:""};f();a.removeLayer(e.all);a.addLayer(e.young);$(".toggle-layer").removeClass("active");$("a[data-mapid='y']").addClass("active")}function j(){$(".toggle-info").on("click",function(m){m.preventDefault();if($(".information").hasClass("hidden")){$(".information").removeClass("hidden")}else{$(".information").addClass("hidden")}});$(".information").on("click",function(m){m.preventDefault();m.stopPropagation();$(".information").addClass("hidden")});$(".information-box").on("click",function(m){m.stopPropagation()})}function f(){var m;if((b.x!==""&&b.y!=="")){m=L.latLng(b.y,b.x);if(!c.bounds_min.contains(m)){m=c.bounds_min.getCenter()}}else{m=c.bounds_min.getCenter()}if(b.z!==""){a.setView(m,Math.max(Math.min(b.z,c.zoom_max),a.options.minZoom))}else{a.fitBounds(c.bounds_min);a.panTo(m)}}function l(){b.z=a.getZoom();b.y=Math.round(a.getCenter().lat*1000)/1000;b.x=Math.round(a.getCenter().lng*1000)/1000}function k(){var m={height:$("#map").height(),width:$("#map").width()};a.options.minZoom=i(c.bounds_min,m)}function d(){L.mapbox.accessToken=c.token;a=L.map("map",{loadingControl:true,attributionControl:false});var m=L.control.attribution({prefix:false}).addTo(a);m.addAttribution('Map data \n<a href="http://creativecommons.org/licenses/by/3.0/nz/" title="CC BY 3.0 NZ" target="_blank">[CC]</a> \n<a href="http://data.linz.govt.nz/" target="_blank" title="Land Information New Zealand">LINZ</a>, \n<a href="http://lris.scinfo.org.nz/" target="_blank" title="Landcare Research New Zealand Ltd">LRIS</a>,  \n<a href="http://www.stats.govt.nz/" target="_blank" title="Statistics New Zealand">Statistics NZ</a> - \na data visualisation by <a class="strong" href="http://dumpark.com" target="_blank" title="dumpark creative industries">dumpark</a></div>');k();a.options.maxZoom=c.zoom_max;a.setMaxBounds(c.bounds_max);a.on("zoomend",l);a.on("dragend",l);f();L.mapbox.tileLayer(c.base_id).setZIndex(1).addTo(a);e.young=L.mapbox.tileLayer(c.young_id).setZIndex(2).addTo(a);$("a[data-mapid='y']").addClass("active");e.all=L.mapbox.tileLayer(c.all_id).setZIndex(2);$(".toggle-layer").on("click",function(o){o.preventDefault();o.stopPropagation();if(!$(this).hasClass("active")){var n=$(this).data();$(".toggle-layer").removeClass("active");if(n.mapid==="y"){a.removeLayer(e.all);a.addLayer(e.young)}else{if(n.mapid==="all"){a.removeLayer(e.young);a.addLayer(e.all)}}$(this).addClass("active")}})}function i(m,p){var t={height:256,width:256};function o(A){var y=Math.sin(A*Math.PI/180);var z=Math.log((1+y)/(1-y))/2;return Math.max(Math.min(z,Math.PI),-Math.PI)/2}function x(A,z,y){return Math.floor(Math.log(A/z/y)/Math.LN2)}var q=m.getNorthEast();var w=m.getSouthWest();var r=(o(q.lat)-o(w.lat))/Math.PI;var u=q.lng-w.lng;var n=((u<0)?(u+360):u)/360;var s=x(p.height,t.height,r);var v=x(p.width,t.width,n);return Math.min(s,v,c.zoom_max)}function g(){if(top!==self){$("body").removeClass("standalone");var o=fullScreenApi.isFullScreen(),m;$(window).on("resize",function(){clearTimeout(m);m=setTimeout(n,300)});function n(){if(o!==fullScreenApi.isFullScreen()){if(o){$("body").removeClass("fullscreen");h()}else{$("body").addClass("fullscreen");h()}o=fullScreenApi.isFullScreen()}}if(top===self){$("body").addClass("standalone")}$("a[data-toggle='fullscreen']").attr("href",c.map_url);$("a[data-toggle='fullscreen']").click(function(q){var p=/webkit/.test(navigator.userAgent.toLowerCase());if(top!==self&&fullScreenApi.supportsFullScreen&&!p){q.preventDefault();$("html").requestFullScreen()}});$("a[data-toggle='fullscreen-close']").attr("href",c.parent_url);$("a[data-toggle='fullscreen-close']").click(function(p){if(top!==self&&fullScreenApi.supportsFullScreen){p.preventDefault();$("html").cancelFullScreen()}})}}$(window).on("resize",function(){k();f()})});